#!/usr/bin/env bash
set -euo pipefail

msg_file="${1:-}"
msg="$(head -n 1 "$msg_file" | tr -d '\r')"

pattern='^(feat|fix|docs|style|refactor|perf|test|build|ci|chore|revert)(\([A-Za-z0-9._/-]+\))?!?: .+'

if [[ "$msg" =~ ^Merge\  ]] || [[ "$msg" =~ ^Revert\  ]]; then
  exit 0
fi

if [[ ! "$msg" =~ $pattern ]]; then
  echo "commit-msg blocked: use Conventional Commits."
  echo "Example: feat(schema): add confidence index"
  exit 1
fi
